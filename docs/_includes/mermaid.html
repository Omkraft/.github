{% if page.mermaid %}
<script type="module">
  import mermaid from "https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs";

  mermaid.initialize({
    startOnLoad: false,
    theme: "base",
    themeVariables: {
      /* Omkraft brand */
      primaryColor: "#3A98F1",
      primaryTextColor: "#ffffff",
      primaryBorderColor: "#05004E",
      lineColor: "#05004E",

      /* Flowchart-specific (REQUIRED in v10) */
      nodeBorder: "#05004E",
      nodeTextColor: "#05004E",
      mainBkg: "#ffffff",
      clusterBkg: "#F6F9FF",
      clusterBorder: "#05004E",
      edgeLabelBackground: "#ffffff",

      /* Typography */
      fontFamily:
        "-apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif",
      fontSize: "14px"
    }
  });

  mermaid.run({
    querySelector: "pre code.language-mermaid"
  });

  // ðŸ”‘ FORCE CENTERING (reliable on GitHub Pages)
  requestAnimationFrame(() => {
    document.querySelectorAll('svg[id^="mermaid-"]').forEach(svg => {
      const wrapper = document.createElement("div");
      wrapper.style.display = "flex";
      wrapper.style.justifyContent = "center";
      wrapper.style.margin = "2rem 0";

      svg.parentNode.insertBefore(wrapper, svg);
      wrapper.appendChild(svg);
    });
  });
</script>
{% endif %}
